function t(t,e,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(t):s?s.value:e.get(t)}function e(t,e,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(t,r):o?o.value=r:e.set(t,r),r}class r{constructor(){this.activeEffects=[],this.onChange=null,this.isSetting=!1,this.actualState=void 0}getTrackableObject(t,e){for(const r in t)t[r]&&"object"==typeof t[r]&&(t[r]=this.getTrackableObject(t[r],e));const r=this,s=new Proxy(t,{get(t,r,s){const o=Reflect.get(t,r,s);return e.onGet(t,r,s),o},set(t,s,o,n){"object"==typeof o&&(o=r.getTrackableObject(o,e));const i=Reflect.set(t,s,o,n);return e.onSet(t,s,o,n),i},deleteProperty(t,r){const s=Reflect.deleteProperty(t,r);return e.onDeleteProperty(t,r),s}});return Array.isArray(t)&&Object.setPrototypeOf(s,Array.prototype),s}build(t){const e=this,r=()=>{this.isSetting?setTimeout(r,2):this.onChange&&this.onChange()};return this.actualState=this.getTrackableObject(t,{onGet(){},onSet(){e.isSetting||(e.isSetting=!0,r()),e.isSetting=!1},onDeleteProperty(){}}),this.actualState}onStateChange(t){this.onChange=t,t()}}const s=t=>HTMLCollection.prototype.isPrototypeOf(t)||NodeList.prototype.isPrototypeOf(t)||Array.isArray(t),o=(t,e,r,s)=>(window.componentMap||(window.componentMap=new WeakMap),!s&&window.componentMap.get(e)||(customElements.define(t,e,r),window.componentMap.set(e,t)),e),n={className:"class"},i=t=>!1===t||null==t,a=(t,e)=>{if(s(e))for(const r of e)i(r)||(Array.isArray(r)?a(t,r):t.append(r));else t.append(e)};var h,c,l,p,f,d,u;const g=new WeakMap,w=[{name:"value",attr:"value"}],y=new Map,m=(t,e)=>t.startsWith("on"),v=t=>t.nodeType===Node.ELEMENT_NODE,b=t=>!0===t.isLeafComponent,A=t=>t.nodeType===Node.TEXT_NODE,E=t=>"string"==typeof t||"number"==typeof t||"boolean"==typeof t,C=(t,e,r)=>{var s;if("string"!=typeof t){const e=null===(s=window.componentMap)||void 0===s?void 0:s.get(t);if(!e)throw new Error("Unable to fetch component from registery.");t=e}const o=document.createElement(t),i=new Set;for(const t in e){const r=e[t];if(m(t)){const e=t.substring(2).toLowerCase();i.add({name:e,handler:r}),o.addEventListener(e,r)}else b(o)&&(o.props[t]=r,!E(r))||!1!==r&&null!=r&&(t in n?o.setAttribute(n[t],r.toString()):o.setAttribute(t,r.toString()))}return g.set(o,i),r&&a(o,r),o},S=(t,e,r)=>void 0===e?C(t):(t=>void 0!==t.nodeType||"string"==typeof t||"number"==typeof t)(e)||s(e)?C(t,r,e):C(t,e),P=(t,e,...r)=>r?S(t,r,null!=e?e:{}):S(t,null!=e?e:{}),T=t=>{if(g.has(t))return g.get(t)},M=(t,e)=>{g.set(t,e||new Set)},N=t=>g.delete(t),k=(t,e)=>{if(s(t))for(const r of t)Array.isArray(r)?k(r,e):e(r);else e(t)},L=(t,e)=>{t.forEach((t=>{e.appendChild(t)}))},x=(t,e,r,s)=>{if(!r)return;let o=t.length,n=e.length;if(v(r)&&v(s)){const t=T(r),e=T(s);null==t||t.forEach((t=>{r.removeEventListener(t.name,t.handler)})),null==e||e.forEach((t=>{r.addEventListener(t.name,t.handler)})),M(r,e),N(s)}for(let s=0,i=0;Math.max(s,i)<Math.min(o,n);s++,i++){let n=t[s];const a=e[i];if(v(n)&&n.hasAttribute("leaf-preserve")&&(n=t[++s],o--),b(n)&&(n.isUpdating=!0),b(a)&&(a.isUpdating=!0),v(n)&&v(a)){const t=Array.prototype.slice.call(n.attributes),e=Array.prototype.slice.call(a.attributes);for(const t of e)if(E(t.value)&&n.getAttribute(t.name)!==t.value&&!1!==t.value&&null!==t.value&&void 0!==t.value){n.setAttribute(t.name,t.value);for(const e of w)e.name===t.name&&(n[e.name]=t.value)}for(const e of t)a.hasAttribute(e.name)||n.removeAttribute(e.name)}if(v(n)&&v(a)&&n.tagName!==a.tagName){let t=n.previousSibling;if(n.outerHTML=n.outerHTML.replace(new RegExp(`<${n.tagName.toLowerCase()}(.*?)`,"g"),`<${a.tagName.toLowerCase()}$1`).replace(new RegExp(`</${n.tagName.toLowerCase()}(.*?)`,"g"),`</${a.tagName.toLowerCase()}$1`),n=t?t.nextSibling:r.firstChild,!v(n))continue;b(n)&&(n.isUpdating=!0)}if(b(n)&&b(a)){for(const t of a.attributes)t.name in a.props||(n.props[t.name]=t.value);for(const t in a.props)n.props[t]=a.props[t];for(const t in n.props)t in a.props||a.hasAttribute(t)||delete n.props[t]}if(A(n)&&A(a)){if(n.textContent===a.textContent)continue;r.replaceChild(a,n)}else A(n)&&v(a)&&(r.replaceChild(a,n),n=a,b(n)&&(n.isUpdating=!0)),v(n)&&A(a)?r.replaceChild(a,n):(x(Array.from(n.childNodes),Array.from(a.childNodes),n,a),b(n)&&(n.isUpdating=!1,n.rerender()))}n>o?e.slice(o).forEach((t=>{t.nodeType!==Node.TEXT_NODE?L([t],r):r.appendChild(t)})):n<o&&t.slice(n).forEach((t=>{r.removeChild(t)}))},O=(t,...e)=>{let r="",s=0;return t.forEach((t=>{r+=t+e[s++]})),r};class R extends HTMLElement{constructor(){super(),h.set(this,null),c.set(this,null),l.set(this,null),p.set(this,null),f.set(this,void 0),d.set(this,!1),u.set(this,null),this.props={},this.isLeafComponent=!0,this.isUpdating=!1;const e={};for(const t of this.constructor.observedAttributes)e[t]=null;const r=this,s=(t,e)=>{if(!Array.isArray(this.constructor.watchedProps)&&t in this.constructor.watchedProps&&null!=e&&!this.isUpdating&&this.constructor.observedAttributes.includes(t)&&this.constructor.watchedProps[t]!==e.constructor)throw new TypeError(`Types of property '${t}' unmatch: expected ${this.constructor.watchedProps[t].name}, got ${e.constructor.name}`)},o={name:"",value:null};this.props=new Proxy(e,{get:(t,e,r)=>(s(e),Reflect.get(t,e,r)),set(e,n,i,a){s(n,i);const h=Reflect.set(e,n,i,a);return!t(r,d,"f")||"key"===n||o.name===n&&o.value===i||(r.onPropChange(n,i),o.name=n,o.value=i),t(r,d,"f")&&r.rerender(),h},has:(t,e)=>r.constructor.observedAttributes.includes(e),deleteProperty:(t,e)=>(s(e),Reflect.deleteProperty(t,e))})}static get observedAttributes(){const t=[];if(Array.isArray(this.watchedProps))t.push(...this.watchedProps);else for(const e in this.watchedProps)t.push(e);return[...t,"key"]}setState(t){e(this,h,t,"f")}getState(){return t(this,d,"f")?t(this,h,"f"):{}}get state(){return this.getState()}set state(t){this.setState(t)}get listeners(){return Array.from(T(this)||[])}fireEvent(t,e){if(t instanceof Event)return t.stopPropagation(),this.fireEvent(t.type,e);const r=new CustomEvent(t,{detail:e});return this.dispatchEvent(r)}rerender(){var r;if(!t(this,p,"f")||this.isUpdating||!t(this,d,"f")||(null===(r=t(this,c,"f"))||void 0===r?void 0:r.isSetting))return;t(this,c,"f")&&(t(this,c,"f").isSetting=!0),t(this,l,"f")?this.onRerender():this.onMounted(),t(this,u,"f")&&(t(this,u,"f").textContent=this.css());let s=this.render();if(Array.isArray(s)||(s=[s]),t(this,c,"f")&&(t(this,c,"f").isSetting=!1),!t(this,l,"f"))return L(s,t(this,p,"f")),void e(this,l,s,"f");x(Array.from(t(this,p,"f").childNodes),Array.from(s),t(this,p,"f"),s[0]),e(this,l,s,"f")}onMounted(){}onRerender(){}onPropChange(t,e){}connectedCallback(){var s,o,n,i;e(this,d,!0,"f"),e(this,p,this.attachShadow({mode:"closed"}),"f"),e(this,u,S("style"),"f"),t(this,u,"f").textContent=this.css(),t(this,u,"f").setAttribute("leaf-preserve","true"),t(this,p,"f").appendChild(t(this,u,"f"));const a=y.get(t(this,f,"f")||"");e(this,c,a||new r,"f"),(null===(s=t(this,c,"f"))||void 0===s?void 0:s.actualState)?e(this,h,t(this,c,"f").actualState,"f"):e(this,h,null===(o=t(this,c,"f"))||void 0===o?void 0:o.build(null!==(n=t(this,h,"f"))&&void 0!==n?n:{}),"f"),t(this,c,"f")&&t(this,f,"f")&&y.set(t(this,f,"f"),t(this,c,"f")),null===(i=t(this,c,"f"))||void 0===i||i.onStateChange((()=>this.rerender()))}attributeChangedCallback(t,r,s){r!==s&&("key"===t&&e(this,f,s,"f"),Array.isArray(this.constructor.watchedProps)?this.props[t]=s:this.constructor.watchedProps[t]===Number?this.props[t]=parseFloat(s):this.props[t]=s)}render(){throw new Error("Render function of `LeafComponent` must be overrided.")}css(){return""}}h=new WeakMap,c=new WeakMap,l=new WeakMap,p=new WeakMap,f=new WeakMap,d=new WeakMap,u=new WeakMap,R.watchedProps=[];export{R as LeafComponent,r as Reactive,S as createElement,P as createElementReactStyle,O as css,N as deleteEventListenerOf,w as directPropUpdate,g as eventListeners,T as getEventListenerOf,v as isElement,m as isEventListener,E as isValidAttribute,L as mountElements,x as patchElements,y as reactiveInstances,o as registerComponent,k as runCallbackOnElements,M as setEventListenerOf};
//# sourceMappingURL=leaf.min.js.map
