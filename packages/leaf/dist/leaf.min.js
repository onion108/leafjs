function t(t,e,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(t):s?s.value:e.get(t)}function e(t,e,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(t,r):o?o.value=r:e.set(t,r),r}class r{constructor(){this.activeEffects=[],this.onChange=null,this.isSetting=!1,this.actualState=void 0}getTrackableObject(t,e){for(const r in t)t[r]&&"object"==typeof t[r]&&(t[r]=this.getTrackableObject(t[r],e));const r=this,s=new Proxy(t,{get(t,r,s){const o=Reflect.get(t,r,s);return e.onGet(t,r,s),o},set(t,s,o,n){"object"==typeof o&&(o=r.getTrackableObject(o,e));const i=Reflect.set(t,s,o,n);return e.onSet(t,s,o,n),i},deleteProperty(t,r){const s=Reflect.deleteProperty(t,r);return e.onDeleteProperty(t,r),s}});return Array.isArray(t)&&Object.setPrototypeOf(s,Array.prototype),s}build(t){const e=this,r=()=>{this.isSetting?setTimeout(r,2):this.onChange&&this.onChange()};return this.actualState=this.getTrackableObject(t,{onGet(){},onSet(){e.isSetting||(e.isSetting=!0,r()),e.isSetting=!1},onDeleteProperty(){}}),this.actualState}onStateChange(t){this.onChange=t,t()}}const s=new WeakMap,o=t=>HTMLCollection.prototype.isPrototypeOf(t)||NodeList.prototype.isPrototypeOf(t)||Array.isArray(t),n=(t,e,r,o)=>(!o&&s.get(e)||(customElements.define(t,e,r),s.set(e,t)),e),i={className:"class"},a=t=>!1===t||null==t,h=(t,e)=>{if(o(e))for(const r of e)a(r)||(Array.isArray(r)?h(t,r):t.append(r));else t.append(e)};var c,l,f,p,u,d,y;const g=new WeakMap,m=[{name:"value",attr:"value"}],w=new Map,v=(t,e)=>t.startsWith("on"),b=t=>t.nodeType===Node.ELEMENT_NODE,A=t=>!0===t.isLeafComponent,E=t=>t.nodeType===Node.TEXT_NODE,C=t=>"string"==typeof t||"number"==typeof t||"boolean"==typeof t,S=(t,e,r)=>{if("string"!=typeof t){const e=s.get(t);if(!e)throw new Error("Unable to fetch component from registery.");t=e}const o=document.createElement(t),n=new Set;for(const t in e){const r=e[t];if(v(t)){const e=t.substring(2).toLowerCase();n.add({name:e,handler:r}),o.addEventListener(e,r)}else A(o)&&(o.props[t]=r,!C(r))||!1!==r&&null!=r&&(t in i?o.setAttribute(i[t],r.toString()):o.setAttribute(t,r.toString()))}return g.set(o,n),r&&h(o,r),o},P=(t,e,r)=>void 0===e?S(t):(t=>void 0!==t.nodeType||"string"==typeof t||"number"==typeof t)(e)||o(e)?S(t,r,e):S(t,e),T=(t,e,...r)=>r?P(t,r,null!=e?e:{}):P(t,null!=e?e:{}),k=t=>{if(g.has(t))return g.get(t)},M=(t,e)=>{g.set(t,e||new Set)},N=t=>g.delete(t),L=(t,e)=>{if(o(t))for(const r of t)Array.isArray(r)?L(r,e):e(r);else e(t)},x=(t,e)=>{t.forEach((t=>{e.appendChild(t)}))},$=(t,e,r,s)=>{if(!r)return;let o=t.length,n=e.length;if(b(r)&&b(s)){const t=k(r),e=k(s);null==t||t.forEach((t=>{r.removeEventListener(t.name,t.handler)})),null==e||e.forEach((t=>{r.addEventListener(t.name,t.handler)})),M(r,e),N(s)}for(let s=0,i=0;Math.max(s,i)<Math.min(o,n);s++,i++){let n=t[s];const a=e[i];if(b(n)&&n.hasAttribute("leaf-preserve")&&(n=t[++s],o--),A(n)&&(n.isUpdating=!0),A(a)&&(a.isUpdating=!0),b(n)&&b(a)){const t=Array.prototype.slice.call(n.attributes),e=Array.prototype.slice.call(a.attributes);for(const t of e)if(C(t.value)&&n.getAttribute(t.name)!==t.value&&!1!==t.value&&null!==t.value&&void 0!==t.value){n.setAttribute(t.name,t.value);for(const e of m)e.name===t.name&&(n[e.name]=t.value)}for(const e of t)a.hasAttribute(e.name)||n.removeAttribute(e.name)}if(b(n)&&b(a)&&n.tagName!==a.tagName){let t=n.previousSibling;if(n.outerHTML=n.outerHTML.replace(new RegExp(`<${n.tagName.toLowerCase()}(.*?)`,"g"),`<${a.tagName.toLowerCase()}$1`).replace(new RegExp(`</${n.tagName.toLowerCase()}(.*?)`,"g"),`</${a.tagName.toLowerCase()}$1`),n=t?t.nextSibling:r.firstChild,!b(n))continue;A(n)&&(n.isUpdating=!0)}if(A(n)&&A(a)){for(const t of a.attributes)t.name in a.props||(n.props[t.name]=t.value);for(const t in a.props)n.props[t]=a.props[t];for(const t in n.props)t in a.props||a.hasAttribute(t)||delete n.props[t]}if(E(n)&&E(a)){if(n.textContent===a.textContent)continue;r.replaceChild(a,n)}else E(n)&&b(a)&&(r.replaceChild(a,n),n=a,A(n)&&(n.isUpdating=!0)),b(n)&&E(a)?r.replaceChild(a,n):($(Array.from(n.childNodes),Array.from(a.childNodes),n,a),A(n)&&(n.isUpdating=!1,n.rerender()))}n>o?e.slice(o).forEach((t=>{t.nodeType!==Node.TEXT_NODE?x([t],r):r.appendChild(t)})):n<o&&t.slice(n).forEach((t=>{r.removeChild(t)}))},O=(t,...e)=>{let r="",s=0;return t.forEach((t=>{r+=t+e[s++]})),r};class R extends HTMLElement{constructor(){super(),c.set(this,null),l.set(this,null),f.set(this,null),p.set(this,null),u.set(this,void 0),d.set(this,!1),y.set(this,null),this.props={},this.isLeafComponent=!0,this.isUpdating=!1;const e={};for(const t of this.constructor.observedAttributes)e[t]=null;const r=this,s=(t,e)=>{if(!this.constructor.observedAttributes.includes(t))throw new Error(`Unknown property ${t}. Expected one of ${this.constructor.observedAttributes.map((t=>`'${t}'`)).join(", ")}.`);if(!Array.isArray(this.constructor.watchedProps)&&t in this.constructor.watchedProps&&null!=e&&!this.isUpdating&&this.constructor.watchedProps[t]!==e.constructor)throw new TypeError(`Types of property '${t}' unmatch: expected ${this.constructor.watchedProps[t].name}, got ${e.constructor.name}`)},o={name:"",value:null};this.props=new Proxy(e,{get:(t,e,r)=>(s(e),Reflect.get(t,e,r)),set(e,n,i,a){s(n,i);const h=Reflect.set(e,n,i,a);return!t(r,d,"f")||"key"===n||o.name===n&&o.value===i||(r.onPropChange(n,i),o.name=n,o.value=i),t(r,d,"f")&&r.rerender(),h},has:(t,e)=>r.constructor.observedAttributes.includes(e),deleteProperty:(t,e)=>(s(e),Reflect.deleteProperty(t,e))})}static get observedAttributes(){const t=[];if(Array.isArray(this.watchedProps))t.push(...this.watchedProps);else for(const e in this.watchedProps)t.push(e);return[...t,"key"]}setState(t){e(this,c,t,"f")}getState(){return t(this,d,"f")?t(this,c,"f"):{}}get state(){return this.getState()}set state(t){this.setState(t)}get listeners(){return Array.from(k(this)||[])}fireEvent(t,e){if(t instanceof Event)return t.stopPropagation(),this.fireEvent(t.type,e);const r=new CustomEvent(t,{detail:e});return this.dispatchEvent(r)}rerender(){var r;if(!t(this,p,"f")||this.isUpdating||!t(this,d,"f")||(null===(r=t(this,l,"f"))||void 0===r?void 0:r.isSetting))return;t(this,l,"f")&&(t(this,l,"f").isSetting=!0),t(this,f,"f")?this.onRerender():this.onMounted(),t(this,y,"f")&&(t(this,y,"f").textContent=this.css());let s=this.render();if(Array.isArray(s)||(s=[s]),t(this,l,"f")&&(t(this,l,"f").isSetting=!1),!t(this,f,"f"))return x(s,t(this,p,"f")),void e(this,f,s,"f");$(Array.from(t(this,p,"f").childNodes),Array.from(s),t(this,p,"f"),s[0]),e(this,f,s,"f")}onMounted(){}onRerender(){}onPropChange(t,e){}connectedCallback(){var s,o,n,i;e(this,d,!0,"f"),e(this,p,this.attachShadow({mode:"closed"}),"f"),e(this,y,P("style"),"f"),t(this,y,"f").textContent=this.css(),t(this,y,"f").setAttribute("leaf-preserve","true"),t(this,p,"f").appendChild(t(this,y,"f"));const a=w.get(t(this,u,"f")||"");e(this,l,a||new r,"f"),(null===(s=t(this,l,"f"))||void 0===s?void 0:s.actualState)?e(this,c,t(this,l,"f").actualState,"f"):e(this,c,null===(o=t(this,l,"f"))||void 0===o?void 0:o.build(null!==(n=t(this,c,"f"))&&void 0!==n?n:{}),"f"),t(this,l,"f")&&t(this,u,"f")&&w.set(t(this,u,"f"),t(this,l,"f")),null===(i=t(this,l,"f"))||void 0===i||i.onStateChange((()=>this.rerender()))}attributeChangedCallback(t,r,s){r!==s&&("key"===t&&e(this,u,s,"f"),Array.isArray(this.constructor.watchedProps)?this.props[t]=s:this.constructor.watchedProps[t]===Number?this.props[t]=parseFloat(s):this.props[t]=s)}render(){throw new Error("Render function of `LeafComponent` must be overrided.")}css(){return""}}c=new WeakMap,l=new WeakMap,f=new WeakMap,p=new WeakMap,u=new WeakMap,d=new WeakMap,y=new WeakMap,R.watchedProps=[];export{R as LeafComponent,r as Reactive,P as createElement,T as createElementReactStyle,O as css,N as deleteEventListenerOf,m as directPropUpdate,g as eventListeners,k as getEventListenerOf,b as isElement,v as isEventListener,C as isValidAttribute,x as mountElements,$ as patchElements,w as reactiveInstances,n as registerComponent,L as runCallbackOnElements,M as setEventListenerOf};
//# sourceMappingURL=leaf.min.js.map
